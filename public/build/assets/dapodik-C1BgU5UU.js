import{ax as q,H as I,ay as J,Y as x,r as h,c as k,o as s,b as v,e as r,f as i,l as L,m as u,t as n,v as p,d as e,F as g,h as R,a1 as E}from"./main-qkHrXkc4.js";import{S as F}from"./sweetalert2-z6gKu1nJ.js";import{u as G}from"./useApi-Dp9jxlMN.js";import{c as H}from"./createUrl-DPMdrIhE.js";import{$ as d}from"./mixins-rZl4ACSd.js";import{$}from"./api-DEnPzuxT.js";import{V as w}from"./VCardText-GlWye268.js";import{V as S}from"./VAlert-BrbmkTSA.js";import{V as K}from"./VTable-CDN-6S4R.js";import{V as D}from"./VChip-D4J-LAp5.js";import{V as M}from"./VCard-DLmDpUr4.js";import"./index-9rIf2CJL.js";import"./VAvatar-BC1zbJAc.js";import"./VImg-jU4EjX8n.js";const U={class:"text-center"},W={class:"text-center"},z={class:"text-center"},O={class:"text-center"},Y={class:"text-center"},me={__name:"dapodik",async setup(Q){let m,V;q({title:`Ambil Data Dapodik | ${I.app.title}`});const{data:_,execute:B}=([m,V]=J(()=>G(H("/sinkronisasi",{query:{sekolah_id:d.sekolah_id,semester_id:d.semester.semester_id,user_id:d.user_id}}))),m=await m,V(),m),C=x(()=>_.value.jam_sinkron),T=x(()=>_.value.data_sinkron),b=x(()=>_.value.error),j=l=>l.dapodik>l.erapor,f=h(!1),y=h(!1),c=h(),A=async()=>{await $(`/sinkronisasi/hitung/${d.sekolah_id}`,{method:"GET",onResponse({request:l,response:a,options:t}){let o=a._data;o.output&&(o.output.jumlah?o.output.jumlah===1&&o.output.inserted===1?c.value="Proses sinkronisasi selesai":c.value=`${o.output.table} (${o.output.inserted}/${o.output.jumlah})`:c.value=o.output.table)}})},P=async(l,a)=>{if(console.log(l),console.log(a),l&&a){y.value=!0,c.value="Menyiapkan proses sinkronisasi",f.value=!0;var t;t=setInterval(A,500),await $("/sinkronisasi/dapodik",{method:"POST",body:{email:d.email,satuan:a,tujuan:l,sekolah_id:d.sekolah_id,semester_id:d.semester.semester_id,user_id:d.user_id},onResponse({request:o,response:N,options:X}){N._data,f.value=!1,y.value=!1,clearInterval(t),c.value="Proses sinkronisasi selesai",F.fire({icon:"success",title:"Berhasil",text:"Sinkronisasi Dapodik Berhasil"}).then(Z=>{B()})}})}};return(l,a)=>(s(),k("div",null,[v(M,null,{default:r(()=>[u(y)?(s(),i(w,{key:0},{default:r(()=>[v(S,{color:"secondary",class:"text-center"},{default:r(()=>[n(p(u(c)),1)]),_:1})]),_:1})):L("",!0),v(w,null,{default:r(()=>[u(C)?(s(),i(S,{key:0,color:"error",class:"text-center",variant:"tonal"},{default:r(()=>a[0]||(a[0]=[e("h2",{class:"mt-4 mb-4"},"Penyesuaian Waktu Layanan Sinkronisasi Dapodik",-1),e("p",null,[n("Dikarenakan adanya proses rutin sinkronisasi data Dapodik antara Server PUSDATIN dan Server Direktorat SMK, "),e("br"),n("maka layanan sinkronisasi hanya dapat diakses antara pukul "),e("span",{class:"text-danger"},[e("b",null,"03.00 s/d 24.00 (WIB)")])],-1)])),_:1})):u(b)?(s(),i(S,{key:1,title:"Pengambilan Dapodik Gagal",type:"error",variant:"tonal"},{default:r(()=>[n(" Status Server: "+p(u(b).message),1)]),_:1})):(s(),i(K,{key:2,class:"text-no-wrap"},{default:r(()=>[a[5]||(a[5]=e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"Data"),e("th",{class:"text-center"},"Jml Dapodik"),e("th",{class:"text-center"},"Jml e-Rapor"),e("th",{class:"text-center"},"Jml Sinkron"),e("th",{class:"text-center"},"Status"),e("th",{class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(s(!0),k(g,null,R(u(T),t=>(s(),k("tr",{key:t.nama},[e("td",null,p(t.nama),1),e("td",U,p(t.dapodik),1),e("td",W,p(t.erapor),1),e("td",z,p(t.sinkron),1),e("td",O,[t.sinkron?(s(),k(g,{key:0},[j(t)?(s(),i(D,{key:0,color:"warning"},{default:r(()=>a[1]||(a[1]=[n("Kurang")])),_:1})):(s(),i(D,{key:1,color:"success"},{default:r(()=>a[2]||(a[2]=[n("Lengkap")])),_:1}))],64)):(s(),i(D,{key:1,color:"error"},{default:r(()=>a[3]||(a[3]=[n("Belum")])),_:1}))]),e("td",Y,[t.dapodik?(s(),i(E,{key:0,loading:u(f),disabled:u(f),size:"small",color:"success",onClick:o=>P(t.server,t.aksi)},{default:r(()=>a[4]||(a[4]=[n(" Sinkronisasi ")])),_:2},1032,["loading","disabled","onClick"])):(s(),k(g,{key:1},[n(" - ")],64))])]))),128))])]),_:1}))]),_:1})]),_:1})]))}};export{me as default};
